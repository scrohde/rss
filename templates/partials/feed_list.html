{{define "feed_list"}}
  <div class="sidebar-header">
    <span>Feeds</span>
    <div class="sidebar-actions">
      <span class="sidebar-count">{{len .Feeds}}</span>
      {{if .FeedEditMode}}
        <div class="feed-edit-actions">
          <button class="chip feed-edit-save" type="submit" form="feed-edit-form">Save</button>
          <button
            class="chip ghost feed-edit-cancel"
            type="button"
            hx-post="/feeds/edit-mode/cancel"
            hx-target="#feed-list"
            hx-swap="innerHTML"
            hx-include="#selected-feed-id"
          >
            Cancel
          </button>
        </div>
      {{else}}
        <button
          class="edit-feeds-button"
          type="button"
          title="Edit feeds"
          aria-label="Edit feeds"
          hx-post="/feeds/edit-mode"
          hx-target="#feed-list"
          hx-swap="innerHTML"
          hx-include="#selected-feed-id"
        >
          <img class="icon" src="/static/icons/pencil.svg" alt="" aria-hidden="true">
          <span class="sr-only">Edit feeds</span>
        </button>
      {{end}}
    </div>
  </div>
  <input type="hidden" id="selected-feed-id" name="selected_feed_id" value="{{.SelectedFeedID}}">
  {{if .FeedEditMode}}
    <form
      id="feed-edit-form"
      class="feed-edit-form"
      hx-post="/feeds/edit-mode/save"
      hx-target="#feed-list"
      hx-swap="innerHTML"
    >
      <input type="hidden" name="selected_feed_id" value="{{.SelectedFeedID}}">
      <ul class="feed-list edit-mode">
        {{if eq (len .Feeds) 0}}
          <li class="feed-empty">No feeds yet.</li>
        {{end}}
        {{range .Feeds}}
          <li class="feed-row" data-feed-id="{{.ID}}" draggable="true">
            <input type="hidden" name="feed_order" value="{{.ID}}">
            <button
              class="feed-drag-handle"
              type="button"
              aria-label="Reorder feed {{.Title}}"
              title="Drag to reorder"
            >
              <img class="icon" src="/static/icons/drag-handle.svg" alt="" aria-hidden="true">
            </button>
            <input
              id="feed-delete-{{.ID}}"
              class="feed-delete-toggle"
              type="checkbox"
              name="feed_delete_{{.ID}}"
              value="1"
            >
            <button
              class="feed-remove feed-remove-mark"
              type="button"
              aria-label="Remove feed {{.Title}}"
              aria-pressed="false"
              data-feed-delete-toggle="feed-delete-{{.ID}}"
            >
              <img class="icon" src="/static/icons/remove-circle.svg" alt="">
            </button>
            <label class="sr-only" for="feed-title-{{.ID}}">Feed name</label>
            <input
              id="feed-title-{{.ID}}"
              class="feed-edit-title {{if eq .ID $.SelectedFeedID}}active{{end}}"
              type="text"
              name="feed_title_{{.ID}}"
              value="{{.Title}}"
              maxlength="140"
            >
            {{if ne .Title .OriginalTitle}}
              <button
                class="feed-title-revert"
                type="button"
                aria-label="Revert feed name to original title: {{.OriginalTitle}}"
                title="Revert to original feed title"
                data-feed-title-input="feed-title-{{.ID}}"
                data-original-title="{{.OriginalTitle}}"
              >
                <img class="icon" src="/static/icons/revert-circle.svg" alt="" aria-hidden="true">
              </button>
            {{end}}
            <span class="feed-delete-pending" role="status">Will be deleted on Save</span>
          </li>
        {{end}}
      </ul>
    </form>
  {{else}}
    <ul class="feed-list">
      {{if eq (len .Feeds) 0}}
        <li class="feed-empty">No feeds yet.</li>
      {{end}}
      {{$hasNoUnreadFeeds := false}}
      {{range .Feeds}}
        {{if eq .UnreadCount 0}}
          {{$hasNoUnreadFeeds = true}}
        {{end}}
      {{end}}
      {{range .Feeds}}
        {{if gt .UnreadCount 0}}
          <li class="feed-row">
            <button
              class="feed-remove"
              type="button"
              aria-label="Remove feed {{.Title}}"
              {{if $.SkipDeleteWarning}}
                hx-post="/feeds/{{.ID}}/delete"
                hx-target="#main-content"
                hx-swap="innerHTML"
                hx-include="#selected-feed-id"
              {{else}}
                hx-get="/feeds/{{.ID}}/delete/confirm"
                hx-target="#feed-remove-confirm-{{.ID}}"
                hx-swap="outerHTML"
              {{end}}
            >
              <img class="icon" src="/static/icons/remove-circle.svg" alt="">
            </button>
            <button class="feed-link {{if eq .ID $.SelectedFeedID}}active{{end}}" type="button" data-feed-id="{{.ID}}" hx-get="/feeds/{{.ID}}/items" hx-target="#main-content" hx-swap="innerHTML">
              <span class="feed-title">{{.Title}}</span>
              <span class="feed-count">{{.UnreadCount}}</span>
            </button>
            <div class="feed-remove-confirm" id="feed-remove-confirm-{{.ID}}"></div>
          </li>
        {{end}}
      {{end}}
      {{if $hasNoUnreadFeeds}}
        <li class="feed-more-section">
          <details class="feed-more-details">
            <summary class="feed-more-button">
              <span class="feed-more-label-collapsed">More</span>
              <span class="feed-more-label-expanded">Less</span>
            </summary>
            <ul class="feed-zero-list">
              {{range .Feeds}}
                {{if eq .UnreadCount 0}}
                  <li class="feed-row">
                    <button
                      class="feed-remove"
                      type="button"
                      aria-label="Remove feed {{.Title}}"
                      {{if $.SkipDeleteWarning}}
                        hx-post="/feeds/{{.ID}}/delete"
                        hx-target="#main-content"
                        hx-swap="innerHTML"
                        hx-include="#selected-feed-id"
                      {{else}}
                        hx-get="/feeds/{{.ID}}/delete/confirm"
                        hx-target="#feed-remove-confirm-{{.ID}}"
                        hx-swap="outerHTML"
                      {{end}}
                    >
                      <img class="icon" src="/static/icons/remove-circle.svg" alt="">
                    </button>
                    <button class="feed-link {{if eq .ID $.SelectedFeedID}}active{{end}}" type="button" data-feed-id="{{.ID}}" hx-get="/feeds/{{.ID}}/items" hx-target="#main-content" hx-swap="innerHTML">
                      <span class="feed-title">{{.Title}}</span>
                      <span class="feed-count">{{.UnreadCount}}</span>
                    </button>
                    <div class="feed-remove-confirm" id="feed-remove-confirm-{{.ID}}"></div>
                  </li>
                {{end}}
              {{end}}
            </ul>
          </details>
        </li>
      {{end}}
    </ul>
  {{end}}
{{end}}
